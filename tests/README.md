# ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ

Advanced Scraper MCPã®åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã§ã™ã€‚

## ğŸ“‹ ãƒ†ã‚¹ãƒˆæ§‹æˆ

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

- **`batch-scraping.test.ts`** - ä¸€æ‹¬ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
- **`proxy-support.test.ts`** - ãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ  
- **`integration.test.ts`** - çµ±åˆãƒ†ã‚¹ãƒˆ
- **`helpers.ts`** - ãƒ†ã‚¹ãƒˆç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
- **`setup.ts`** - ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ãƒ†ã‚¹ãƒˆç¨®åˆ¥

| ãƒ†ã‚¹ãƒˆç¨®åˆ¥ | èª¬æ˜ | ãƒ•ã‚¡ã‚¤ãƒ« |
|-----------|------|---------|
| **ä¸€æ‹¬ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°** | è¤‡æ•°URLåŒæ™‚å‡¦ç†ã€ä¸¦è¡Œåˆ¶å¾¡ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | `batch-scraping.test.ts` |
| **ãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œ** | HTTP/SOCKS ãƒ—ãƒ­ã‚­ã‚·ã€èªè¨¼ã€è¨­å®šæ¤œè¨¼ | `proxy-support.test.ts` |
| **çµ±åˆãƒ†ã‚¹ãƒˆ** | ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | `integration.test.ts` |

## ğŸš€ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•

### åŸºæœ¬çš„ãªå®Ÿè¡Œ

```bash
# å…¨ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm test

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®ã¿å®Ÿè¡Œ
npm run test:batch    # ä¸€æ‹¬ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
npm run test:proxy    # ãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œãƒ†ã‚¹ãƒˆ

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§å®Ÿè¡Œ
npm run test:coverage

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
npm run test:watch
```

### è©³ç´°ãªå®Ÿè¡Œã‚ªãƒ—ã‚·ãƒ§ãƒ³

```bash
# ç›´æ¥å®Ÿè¡Œï¼ˆã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
npx jest --testPathPattern="batch-scraping" --verbose
npx jest --testPathPattern="proxy-support" --coverage
npx jest --testPathPattern="integration" --detectOpenHandles

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ã¿å®Ÿè¡Œ
npx jest --testNamePattern="should scrape multiple URLs"
npx jest --testNamePattern="proxy"
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆå†…å®¹è©³ç´°

### ä¸€æ‹¬ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ

#### åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- âœ… è¤‡æ•°URLåŒæ™‚ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
- âœ… æˆåŠŸãƒ»å¤±æ•—ã®æ··åœ¨å‡¦ç†
- âœ… ä¸¦è¡Œæ•°åˆ¶å¾¡ï¼ˆã‚»ãƒãƒ•ã‚©ï¼‰
- âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“æ¸¬å®š

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- âœ… ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼å‡¦ç†
- âœ… ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå‡¦ç†
- âœ… ç©ºURLé…åˆ—ã®å‡¦ç†
- âœ… ç„¡åŠ¹URLã®å‡¦ç†

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- âœ… ä¸¦è¡Œå‡¦ç†åŠ¹ç‡
- âœ… ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- âœ… å‡¦ç†æ™‚é–“åˆ¶é™

### ãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œãƒ†ã‚¹ãƒˆ

#### ãƒ—ãƒ­ã‚­ã‚·è¨­å®š
- âœ… HTTP/HTTPSãƒ—ãƒ­ã‚­ã‚·
- âœ… SOCKS4/SOCKS5ãƒ—ãƒ­ã‚­ã‚·
- âœ… èªè¨¼æƒ…å ±è¨­å®š
- âœ… è¨­å®šæ¤œè¨¼

#### èªè¨¼ãƒ†ã‚¹ãƒˆ
- âœ… Basicèªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆ
- âœ… ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€èªè¨¼æƒ…å ±
- âœ… èªè¨¼å¤±æ•—å‡¦ç†
- âœ… ç„¡åŠ¹ãªèªè¨¼æƒ…å ±

#### Puppeteeré€£æº
- âœ… ãƒ—ãƒ­ã‚­ã‚·å¼•æ•°ç”Ÿæˆ
- âœ… èªè¨¼è¨­å®š
- âœ… æ¥ç¶šã‚¨ãƒ©ãƒ¼å‡¦ç†

### çµ±åˆãƒ†ã‚¹ãƒˆ

#### ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰
- âœ… å®Œå…¨ãªã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- âœ… è¤‡æ•°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å½¢å¼å¯¾å¿œ
- âœ… ãƒ‡ãƒ¼ã‚¿å“è³ªæ¤œè¨¼
- âœ… æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- âœ… ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
- âœ… è² è·ãƒ†ã‚¹ãƒˆ
- âœ… å¿œç­”æ™‚é–“æ¸¬å®š
- âœ… ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- âœ… XSSæ”»æ’ƒå¯¾ç­–
- âœ… URLæ¤œè¨¼
- âœ… HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
- âœ… æ‚ªæ„ã®ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å‡¦ç†

## ğŸ› ï¸ ãƒ†ã‚¹ãƒˆç’°å¢ƒ

### ä¾å­˜é–¢ä¿‚

```json
{
  "jest": "^29.7.0",
  "ts-jest": "^29.1.0",
  "@types/jest": "^29.5.0",
  "nock": "^13.4.0",
  "proxy": "^2.1.1"
}
```

### ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼

ãƒ†ã‚¹ãƒˆã§ã¯ä»¥ä¸‹ã®ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ï¼š

- **HTTPã‚µãƒ¼ãƒãƒ¼** - ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é…ä¿¡
- **ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼** - ãƒ—ãƒ­ã‚­ã‚·æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- **é…å»¶ã‚µãƒ¼ãƒãƒ¼** - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ†ã‚¹ãƒˆ

### ãƒãƒ¼ãƒˆç®¡ç†

- å‹•çš„ãƒãƒ¼ãƒˆå‰²ã‚Šå½“ã¦ï¼ˆ3001ç•ªã‹ã‚‰æ¤œç´¢ï¼‰
- ãƒãƒ¼ãƒˆç«¶åˆå›é¿
- ãƒ†ã‚¹ãƒˆå¾Œã®è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

## ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

| é …ç›® | ç›®æ¨™ | ç¾åœ¨ |
|------|------|------|
| **è¡Œã‚«ãƒãƒ¬ãƒƒã‚¸** | 90%+ | - |
| **é–¢æ•°ã‚«ãƒãƒ¬ãƒƒã‚¸** | 95%+ | - |
| **åˆ†å²ã‚«ãƒãƒ¬ãƒƒã‚¸** | 85%+ | - |

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### ãƒãƒ¼ãƒˆç«¶åˆã‚¨ãƒ©ãƒ¼
```bash
Error: listen EADDRINUSE :::3001
```
**è§£æ±ºæ–¹æ³•**: ä»–ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯è‡ªå‹•çš„ã«åˆ¥ã®ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

#### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼
```bash
Timeout - Async callback was not invoked within the 5000 ms timeout
```
**è§£æ±ºæ–¹æ³•**: `jest.setTimeout(30000)` ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’å»¶é•·æ¸ˆã¿ã€‚

#### ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯è­¦å‘Š
```bash
Jest detected open handles
```
**è§£æ±ºæ–¹æ³•**: `--detectOpenHandles --forceExit` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å¯¾å¿œæ¸ˆã¿ã€‚

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

```bash
# è©³ç´°ãƒ­ã‚°ä»˜ãã§å®Ÿè¡Œ
DEBUG=* npm test

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿ãƒ‡ãƒãƒƒã‚°
npx jest --testNamePattern="specific test" --verbose

# Node.jsãƒ‡ãƒãƒƒã‚¬ãƒ¼ã§å®Ÿè¡Œ
node --inspect-brk node_modules/.bin/jest --runInBand
```

## ğŸ“ ãƒ†ã‚¹ãƒˆè¿½åŠ ã‚¬ã‚¤ãƒ‰

### æ–°ã—ã„ãƒ†ã‚¹ãƒˆã®è¿½åŠ 

1. **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**
   ```typescript
   // tests/new-feature.test.ts
   import { describe, test, expect } from '@jest/globals';
   
   describe('New Feature Tests', () => {
     test('should work correctly', () => {
       expect(true).toBe(true);
     });
   });
   ```

2. **ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®åˆ©ç”¨**
   ```typescript
   import { createMockServer, findAvailablePort } from './helpers.js';
   ```

3. **ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã«è¿½åŠ **
   ```typescript
   // tests/run-tests.ts ã«è¿½åŠ 
   {
     name: 'new-feature',
     pattern: '**/new-feature.test.ts',
     description: 'æ–°æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ'
   }
   ```

### ãƒ†ã‚¹ãƒˆã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

- **ç‹¬ç«‹æ€§**: å„ãƒ†ã‚¹ãƒˆã¯ä»–ã®ãƒ†ã‚¹ãƒˆã«ä¾å­˜ã—ãªã„
- **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: ãƒªã‚½ãƒ¼ã‚¹ã®é©åˆ‡ãªè§£æ”¾
- **ãƒ¢ãƒƒã‚¯**: å¤–éƒ¨ä¾å­˜é–¢ä¿‚ã®ãƒ¢ãƒƒã‚¯åŒ–
- **ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³**: æ˜ç¢ºã§å…·ä½“çš„ãªæ¤œè¨¼
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: ãƒ†ã‚¹ãƒˆã®ç›®çš„ã¨æœŸå¾…å€¤ã‚’æ˜è¨˜

## ğŸ”„ CI/CDçµ±åˆ

### GitHub Actionsè¨­å®šä¾‹

```yaml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run test:coverage
      - uses: codecov/codecov-action@v3
```

### ç¶™ç¶šçš„å“è³ªç®¡ç†

- **è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**: ãƒ—ãƒƒã‚·ãƒ¥ãƒ»ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚
- **ã‚«ãƒãƒ¬ãƒƒã‚¸ç›£è¦–**: Codecové€£æº
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**: ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœã®è¿½è·¡
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³**: ä¾å­˜é–¢ä¿‚ã®è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯ 